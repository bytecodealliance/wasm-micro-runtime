# ts2wasm runtime library

This folder contains code to be built into WAMR runtime to expose required APIs for executing wasm modules generated by ts2wasm compiler, including:
- libdyntype API: APIs for supporting dynamic objects
- struct-dyn API: APIs for accessing wasmGC struct fields through dynamically calculated index
- stdlib API: APIs for providing standard library functions such as `console.log`

## Build 

``` bash
# prepare dependencies
cd deps
./download.sh
cd -

# build runtime
mkdir build && cd build
cmake ..
make
```

This will generate an `iwasm_gc` executable which can be used to execute wasm modules generated by ts2wasm compiler.

## Run

``` bash
./iwasm_gc -f <export_func_name> <wasm file> [<args>]
# e.g.
./iwasm_gc -f consoleLog builtin_console.wasm
```

## Known issues

- Garbage collection for libdyntype not implemented, so if there are `any` in the source code, there will be memory leak.

    > This will also cause assertion error in debug build, since quickjs will assert the heap is empty before exit.
